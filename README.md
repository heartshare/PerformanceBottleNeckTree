# PerformanceBottleNeckTree
大型网站性能瓶颈分析


<pre>
压力测试如何进行
 
     一个完整的性能测试方案通常包括以下几个方面：

          1）压力测试及生成性能报告
             压力测试的一个重点是如何产生压力，通常可以自己编写脚本模拟请求，或是使用成熟
             的压测工具进行。

          2）根据性能报告定位系统性能瓶颈，进行针对性优化，测试和优化的工作可以和日常开发并行。
             压力测试完成以后，拿到一份压力测试报告，这个报告通常会告诉我们系统的QPS, TPS
          ，响应时延等数据。

             这些数据可以让我们对服务器的性能有个整体的了解，发现存在的问题，但是不能帮助
          我们定位问题。

	         这个时候可以从系统的各个组件入手，关注系统的CPU，内存，IO，网络，对比这些环节
          对整体性能的影响，确实性能问题是系统哪一部分造成的，然后针对性的在系统中逐个优化。

          3）估算容量承载能力，合理规划系统资源
             进行压力测试的一个重要目的是让现有的服务器资源发挥最大的价值。
             经过前期的测试和分析，这时候我们队系统整体的性能有了一个认识，对服务器的承载
             能力有了预估。
             这个时候就可以结合业务规模配置服务器数量，CDN资源，让最少的资源产生最大的价值。
</pre>

<pre>
如何监控系统资源，定位性能瓶颈

           压力测试可以暴露性能问题，如高并发下访问缓慢，服务宕机等，但是通过压力测试不能
      具体定位到哪里是瓶颈，必须要在压力测试同时配合适当的资源监控，帮助我们定位。

      1）配置合理的资源监控方案
           1）使用nmon监控系统性能。
              nmon是Linux上广泛使用的监控和分析工具，记录信息全面，能在系统运行过程中实
           时的捕捉系统资源的使用情况，并且能输出结果到文件中，然后通过nmon_analyzer工
           具产生数据文件和图形化结果。

           nmon所记录的数据包含以下方面：
               1）CPU占用率
               2）内存使用情况
               3）磁盘IO速度，传输，读写比率
               5）文件系统的使用率
               6）网络IO速率，传输，读写比率，错误统计率与传输包的大小。
               7）消耗资源最多的进程。
               8）计算机详细信息和资源
               9）页面空间和页面IO速度
               10）用户自定义的磁盘组
               11）网络文件系统。

     典型的调整目标与解决方案：
          （1）系统对高并发的场景响应不足，如数据库连接池过低，服务器连接数超过上限，数据
               库锁控制考虑不足等
          （2）内存泄露，如在长时间运行下，内存没有正常释放，发生宕机等
          （3）数据库优化不足，业务日益增长，关联表众多，SQL不够优化等

           定位到上述问题，接下来就是提出合理的调整目标，
               比如服务器资源有限，可以通过配置更多的机器，服务上云等进行优化；
               如果对高并发支持不好，就可以在代码层面优化，提高并发支持；
               数据库性能问题，如慢查询等问题，就可以进行 SQL语句优化等。

     进行基准测试并分析调优结果
         数据说明一切，性能优化的结果不能简答的通过“感觉系统变快了”了衡量，最好是通过对比
     优化前后的测试结果，用图表的方式直观的把优化结果展示出来。基准测试时指通过设计科学的
     测试工具和方式方法，实现对一类测试对象的某项性能指标进行定量的和可对比的测试，对比
     测试结果，结合容量评估等工作，可以让系统发挥最大的作用。

         一个阶段的优化工作完成以后，最好是总结反思一下，比如本次优化是否达到了目标？系统的
     整体性能是否得到了改善？用户体验是否得到了提升？以及如何在接下来的开发中做的更好。
</pre>